PROGRAM Test 
        USE Objective_acstem, ONLY: ACSTEM_FUNC, simulated_image
        IMPLICIT NONE
        INTEGER, PARAMETER :: NATOMS=55, NROWS=128, NCOLS=128
        REAL(8), PARAMETER :: SIGMA=0.010D0, BETA=0.0D0
        REAL(8), DIMENSION(NROWS, NCOLS) :: IMAGE
        REAL(8), DIMENSION(3*NATOMS+2) :: COORDS
        REAL(8), DIMENSION(3*NATOMS+2) :: GRAD
        REAL(8) :: ENERGY
        LOGICAL :: GTEST=.TRUE., HTEST=.FALSE.
        CHARACTER(LEN=256) :: FILENAME = "M55"
        INTEGER :: I, MYUNIT         
        !CALL READCOORDINATES(FILENAME, NATOMS, filetype, COORDS)
        OPEN(NEWUNIT=MYUNIT, FILE=ADJUSTL(TRIM(FILENAME))//".xyz", ACTION="READ", STATUS="OLD")
        READ(MYUNIT, *)
        READ(MYUNIT, *)
        DO I=1, NATOMS
                READ(MYUNIT, *) COORDS(3*I-2:3*I)
        ENDDO
        COORDS=COORDS + 1.8D0   !MAXVAL(COORDS)
        COORDS(3*NATOMS+1) = 0.20D0
        COORDS(3*NATOMS+2) = 0.0D0
        CALL ACSTEM_FUNC(3*NATOMS, COORDS, ENERGY, GRAD, gtest, htest)
        CLOSE(MYUNIT)
        OPEN(NEWUNIT=MYUNIT, FILE=ADJUSTL(TRIM(FILENAME))//".txt",ACTION="WRITE", STATUS="REPLACE")
        DO I=1, NROWS
                WRITE(MYUNIT, *) SIMULATED_IMAGE(I,:)
        ENDDO
        CLOSE(MYUNIT)
END PROGRAM Test

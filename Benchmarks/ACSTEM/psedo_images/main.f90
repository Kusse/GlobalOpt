PROGRAM MAIN
        USE ACSTEM_OBJECTIVE, ONLY: ACSTEM_FUNC, simulated_image
        IMPLICIT NONE
        INTEGER, PARAMETER :: NATOMS=55, NROWS=128, NCOLS=128
        REAL(8), PARAMETER :: SIGMA=1.0D0, BETA=0.0D0
        REAL(8), DIMENSION(NROWS, NCOLS) :: IMAGE
        REAL(8), DIMENSION(3*NATOMS) :: COORDS
        REAL(8), DIMENISON(3*NATOMS) :: GRAD
        REAL(8) :: ENERGY
        LOGICAL :: GTEST=.TRUE., HTEST=.FALSE.
        CHARACTER(LEN=256) :: FILENAME = "M55.XYZ"
         
        !CALL READCOORDINATES(FILENAME, NATOMS, filetype, COORDS)
        OPEN(NEWUNIT=MYUNIT, FILE=ADJUSTL(TRIM(FILENAME)), ACTION="READ", STATUS="OLD")
        DO I=1, NATOMS
                READ(MYUNIT, *) COORDS(3*I-2:3*I)
        ENDDO
        CALL ACSTEM_FUNC(3*NATOMS, COORDS, ENERGY, GRAD, gtest, htest)
        CLOSE(MYUNIT)
        OPEN(NEWUNIT=MYUNIT, FILE=ADJUSTL(TRIM(FILENAME))//".txt",ACTION="WRITE", STATUS="REPLACE")
        DO I=1, NROWS
                WRITE(MYUNIT, *) SIMULATED_IMAGE(I,:)
        ENDDO
        CLOSE(MYUNIT)
END PROGRAM MAIN}
